<canvas id="robot" class="h-screen w-screen opacity-50 pointer-events-none absolute top-0 left-0 right-0" />
<script>
    import { HEXA_WHITE, createBaseScene, loadScene } from "../../../assets/scripts/threeUtils.ts";
    import { Color } from "three";
    import { FBXLoader } from 'three/examples/jsm/loaders/FBXLoader';
    import WebGL from 'three/examples/jsm/capabilities/WebGL.js';

    const MODEL_PATH = "/portfolio/models/robot/character";
    const canvas = document.getElementById("robot");
    const color = new Color(HEXA_WHITE);
    const loader = new FBXLoader();
    let animationFrame;

    const POS = {
        x: 0,
        y: -30,
        z: -500
    };

	if(WebGL.isWebGLAvailable() && canvas) {
		const { scene, animate, mixer, killScene } = createBaseScene({ canvas, color });

		const onAnimate = () => {
			animate();
			animationFrame = window.requestAnimationFrame(onAnimate);
		};

		// const handleRemoveEventListeners = () => {
		// 	cancelAnimationFrame(animationFrame);
		// 	killScene();
		// };

        loadScene({ color, loader, path: `${MODEL_PATH}@run.fbx` })
            .then(async (robot) => {
                const walkingRobot = await loadScene({ color, loader, path: `${MODEL_PATH}@walk.fbx` });
                const runningRobot = await loadScene({ color, loader, path: `${MODEL_PATH}@run.fbx` });

                robot.animations.push(walkingRobot.animations[0]);
                robot.animations.push(runningRobot.animations[0]);
                robot.position.set(POS.x, POS.y, POS.z);

                return robot;
            })
            .then((robot) => {
                scene.add(robot);
                mixer.clipAction(robot.animations[0]).play();
            });

		onAnimate();
	}

</script>